!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e||self).ColorThief=r()}(this,function(){if(!e)var e={map:function(e,r){var n={};return r?e.map(function(e,t){return n.index=t,r.call(n,e)}):e.slice()},naturalOrder:function(e,r){return e<r?-1:e>r?1:0},sum:function(e,r){var n={};return e.reduce(r?function(e,t,o){return n.index=o,e+r.call(n,t)}:function(e,r){return e+r},0)},max:function(r,n){return Math.max.apply(null,n?e.map(r,n):r)}};var r=function(){var r=5,n=8-r,t=1e3;function o(e,n,t){return(e<<2*r)+(n<<r)+t}function i(e){var r=[],n=!1;function t(){r.sort(e),n=!0}return{push:function(e){r.push(e),n=!1},peek:function(e){return n||t(),void 0===e&&(e=r.length-1),r[e]},pop:function(){return n||t(),r.pop()},size:function(){return r.length},map:function(e){return r.map(e)},debug:function(){return n||t(),r}}}function a(e,r,n,t,o,i,a){var u=this;u.r1=e,u.r2=r,u.g1=n,u.g2=t,u.b1=o,u.b2=i,u.histo=a}function u(){this.vboxes=new i(function(r,n){return e.naturalOrder(r.vbox.count()*r.vbox.volume(),n.vbox.count()*n.vbox.volume())})}function s(r,n){if(n.count()){var t=n.r2-n.r1+1,i=n.g2-n.g1+1,a=e.max([t,i,n.b2-n.b1+1]);if(1==n.count())return[n.copy()];var u,s,c,h,f=0,l=[],p=[];if(a==t)for(u=n.r1;u<=n.r2;u++){for(h=0,s=n.g1;s<=n.g2;s++)for(c=n.b1;c<=n.b2;c++)h+=r[o(u,s,c)]||0;l[u]=f+=h}else if(a==i)for(u=n.g1;u<=n.g2;u++){for(h=0,s=n.r1;s<=n.r2;s++)for(c=n.b1;c<=n.b2;c++)h+=r[o(s,u,c)]||0;l[u]=f+=h}else for(u=n.b1;u<=n.b2;u++){for(h=0,s=n.r1;s<=n.r2;s++)for(c=n.g1;c<=n.g2;c++)h+=r[o(s,c,u)]||0;l[u]=f+=h}return l.forEach(function(e,r){p[r]=f-e}),function(e){var r,t,o,i,a,s=e+"1",c=e+"2",h=0;for(u=n[s];u<=n[c];u++)if(l[u]>f/2){for(o=n.copy(),i=n.copy(),a=(r=u-n[s])<=(t=n[c]-u)?Math.min(n[c]-1,~~(u+t/2)):Math.max(n[s],~~(u-1-r/2));!l[a];)a++;for(h=p[a];!h&&l[a-1];)h=p[--a];return o[c]=a,i[s]=o[c]+1,[o,i]}}(a==t?"r":a==i?"g":"b")}}return a.prototype={volume:function(e){var r=this;return r._volume&&!e||(r._volume=(r.r2-r.r1+1)*(r.g2-r.g1+1)*(r.b2-r.b1+1)),r._volume},count:function(e){var r=this,n=r.histo;if(!r._count_set||e){var t,i,a,u=0;for(t=r.r1;t<=r.r2;t++)for(i=r.g1;i<=r.g2;i++)for(a=r.b1;a<=r.b2;a++)u+=n[o(t,i,a)]||0;r._count=u,r._count_set=!0}return r._count},copy:function(){var e=this;return new a(e.r1,e.r2,e.g1,e.g2,e.b1,e.b2,e.histo)},avg:function(e){var n=this,t=n.histo;if(!n._avg||e){var i,a,u,s,c=0,h=1<<8-r,f=0,l=0,p=0;for(a=n.r1;a<=n.r2;a++)for(u=n.g1;u<=n.g2;u++)for(s=n.b1;s<=n.b2;s++)c+=i=t[o(a,u,s)]||0,f+=i*(a+.5)*h,l+=i*(u+.5)*h,p+=i*(s+.5)*h;n._avg=c?[~~(f/c),~~(l/c),~~(p/c)]:[~~(h*(n.r1+n.r2+1)/2),~~(h*(n.g1+n.g2+1)/2),~~(h*(n.b1+n.b2+1)/2)]}return n._avg},contains:function(e){var r=this,t=e[0]>>n;return gval=e[1]>>n,bval=e[2]>>n,t>=r.r1&&t<=r.r2&&gval>=r.g1&&gval<=r.g2&&bval>=r.b1&&bval<=r.b2}},u.prototype={push:function(e){this.vboxes.push({vbox:e,color:e.avg()})},palette:function(){return this.vboxes.map(function(e){return e.color})},size:function(){return this.vboxes.size()},map:function(e){for(var r=this.vboxes,n=0;n<r.size();n++)if(r.peek(n).vbox.contains(e))return r.peek(n).color;return this.nearest(e)},nearest:function(e){for(var r,n,t,o=this.vboxes,i=0;i<o.size();i++)((n=Math.sqrt(Math.pow(e[0]-o.peek(i).color[0],2)+Math.pow(e[1]-o.peek(i).color[1],2)+Math.pow(e[2]-o.peek(i).color[2],2)))<r||void 0===r)&&(r=n,t=o.peek(i).color);return t},forcebw:function(){var r=this.vboxes;r.sort(function(r,n){return e.naturalOrder(e.sum(r.color),e.sum(n.color))});var n=r[0].color;n[0]<5&&n[1]<5&&n[2]<5&&(r[0].color=[0,0,0]);var t=r.length-1,o=r[t].color;o[0]>251&&o[1]>251&&o[2]>251&&(r[t].color=[255,255,255])}},{quantize:function(c,h){if(!c.length||h<2||h>256)return!1;var f=function(e){var t,i=new Array(1<<3*r);return e.forEach(function(e){t=o(e[0]>>n,e[1]>>n,e[2]>>n),i[t]=(i[t]||0)+1}),i}(c);f.forEach(function(){});var l=function(e,r){var t,o,i,u=1e6,s=0,c=1e6,h=0,f=1e6,l=0;return e.forEach(function(e){(t=e[0]>>n)<u?u=t:t>s&&(s=t),(o=e[1]>>n)<c?c=o:o>h&&(h=o),(i=e[2]>>n)<f?f=i:i>l&&(l=i)}),new a(u,s,c,h,f,l,r)}(c,f),p=new i(function(r,n){return e.naturalOrder(r.count(),n.count())});function d(e,r){for(var n,o=e.size(),i=0;i<t;){if(o>=r)return;if(i++>t)return;if((n=e.pop()).count()){var a=s(f,n),u=a[0],c=a[1];if(!u)return;e.push(u),c&&(e.push(c),o++)}else e.push(n),i++}}p.push(l),d(p,.75*h);for(var v=new i(function(r,n){return e.naturalOrder(r.count()*r.volume(),n.count()*n.volume())});p.size();)v.push(p.pop());d(v,h);for(var g=new u;v.size();)g.push(v.pop());return g}}}().quantize,n=function(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=e.naturalWidth,this.height=this.canvas.height=e.naturalHeight,this.context.drawImage(e,0,0,this.width,this.height)};n.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var t=function(){};return t.prototype.getColor=function(e,r,n){return void 0===r&&(r=10),void 0===n&&(n=!1),this.getPalette(e,5,r,n)[0]},t.prototype.getPalette=function(e,t,o,i,a,u){void 0===i&&(i=!1),void 0===a&&(a=!1),void 0===u&&(u={pixelConsideredTransparentThreshold:10,imageConsideredTransparentThreshold:.1});var s=function(e){var r=e.colorCount,n=e.quality,t=e.includeWhite,o=e.checkTransparency,i=e.checkTransparencyConfig;if(void 0!==r&&Number.isInteger(r)){if(1===r)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");r=Math.max(r,2),r=Math.min(r,20)}else r=10;if((void 0===n||!Number.isInteger(n)||n<1)&&(n=10),void 0!==t&&"boolean"==typeof t||(t=!1),void 0===o||"boolean"!=typeof o)o=!1;else if(void 0===i||"object"!=typeof i)i={pixelConsideredTransparentThreshold:10,imageConsideredTransparentThreshold:.1};else{var a=i.pixelConsideredTransparentThreshold,u=i.imageConsideredTransparentThreshold;if((void 0===a||Number.isNaN(a))&&(i.pixelConsideredTransparentThreshold=10),a<0||a>255)throw new Error("pixelConsideredTransparentThreshold should be between 0 and 255. Default is 10, meaning if a pixel's alpha (0-255) is less than this 10, the pixel is counted towards the overall transparency check.");if((void 0===u||Number.isNaN(u))&&(i.imageConsideredTransparentThreshold=.1),u<0||u>1)throw new Error("pixelConsideredTransparentThreshold should be between 0 and 1. Default is 0.1, meaning if 10% of the pixels trigger the pixelConsideredTransparentThreshold check, the image is considered transparent.")}return{colorCount:r,quality:n,includeWhite:t,checkTransparency:o,checkTransparencyConfig:i}}({colorCount:t,quality:o,includeWhite:i,checkTransparency:a,checkTransparencyConfig:u}),c=new n(e),h=function(e,r,n){for(var t,o,i,a,u,s=n.quality,c=n.includeWhite,h=n.checkTransparency,f=n.checkTransparencyConfig,l=e,p=[],d=0,v=0;v<r;v+=s)o=l[0+(t=4*v)],i=l[t+1],a=l[t+2],void 0===(u=l[t+3])||u>=125?o>250&&i>250&&a>250&&!c||p.push([o,i,a]):h&&u<f.pixelConsideredTransparentThreshold&&d++;return{pixelArray:p,hasTransparency:h&&d/r.length>f.imageConsideredTransparentThreshold}}(c.getImageData().data,c.width*c.height,s),f=h.hasTransparency,l=r(h.pixelArray,s.colorCount),p=l?l.palette():null;return a?{palette:p,hasTransparency:f}:p},t.prototype.getColorFromUrl=function(e,r,n){var t=this,o=document.createElement("img");o.addEventListener("load",function(){var i=t.getPalette(o,5,n);r(i[0],e)}),o.src=e},t.prototype.getImageData=function(e,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){if(200==this.status){var e=new Uint8Array(this.response);i=e.length;for(var n=new Array(i),t=0;t<e.length;t++)n[t]=String.fromCharCode(e[t]);var o=n.join(""),a=window.btoa(o);r("data:image/png;base64,"+a)}},n.send()},t.prototype.getColorAsync=function(e,r,n){var t=this;this.getImageData(e,function(e){var o=document.createElement("img");o.addEventListener("load",function(){var e=t.getPalette(o,5,n);r(e[0],this)}),o.src=e})},t});
