if(!e)var e={map:function(e,r){var t={};return r?e.map(function(e,n){return t.index=n,r.call(t,e)}):e.slice()},naturalOrder:function(e,r){return e<r?-1:e>r?1:0},sum:function(e,r){var t={};return e.reduce(r?function(e,n,o){return t.index=o,e+r.call(t,n)}:function(e,r){return e+r},0)},max:function(r,t){return Math.max.apply(null,t?e.map(r,t):r)}};var r=function(){var r=5,t=8-r,n=1e3;function o(e,t,n){return(e<<2*r)+(t<<r)+n}function a(e){var r=[],t=!1;function n(){r.sort(e),t=!0}return{push:function(e){r.push(e),t=!1},peek:function(e){return t||n(),void 0===e&&(e=r.length-1),r[e]},pop:function(){return t||n(),r.pop()},size:function(){return r.length},map:function(e){return r.map(e)},debug:function(){return t||n(),r}}}function i(e,r,t,n,o,a,i){var s=this;s.r1=e,s.r2=r,s.g1=t,s.g2=n,s.b1=o,s.b2=a,s.histo=i}function s(){this.vboxes=new a(function(r,t){return e.naturalOrder(r.vbox.count()*r.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function u(r,t){if(t.count()){var n=t.r2-t.r1+1,a=t.g2-t.g1+1,i=e.max([n,a,t.b2-t.b1+1]);if(1==t.count())return[t.copy()];var s,u,c,h,l=0,f=[],p=[];if(i==n)for(s=t.r1;s<=t.r2;s++){for(h=0,u=t.g1;u<=t.g2;u++)for(c=t.b1;c<=t.b2;c++)h+=r[o(s,u,c)]||0;f[s]=l+=h}else if(i==a)for(s=t.g1;s<=t.g2;s++){for(h=0,u=t.r1;u<=t.r2;u++)for(c=t.b1;c<=t.b2;c++)h+=r[o(u,s,c)]||0;f[s]=l+=h}else for(s=t.b1;s<=t.b2;s++){for(h=0,u=t.r1;u<=t.r2;u++)for(c=t.g1;c<=t.g2;c++)h+=r[o(u,c,s)]||0;f[s]=l+=h}return f.forEach(function(e,r){p[r]=l-e}),function(e){var r,n,o,a,i,u=e+"1",c=e+"2",h=0;for(s=t[u];s<=t[c];s++)if(f[s]>l/2){for(o=t.copy(),a=t.copy(),i=(r=s-t[u])<=(n=t[c]-s)?Math.min(t[c]-1,~~(s+n/2)):Math.max(t[u],~~(s-1-r/2));!f[i];)i++;for(h=p[i];!h&&f[i-1];)h=p[--i];return o[c]=i,a[u]=o[c]+1,[o,a]}}(i==n?"r":i==a?"g":"b")}}return i.prototype={volume:function(e){var r=this;return r._volume&&!e||(r._volume=(r.r2-r.r1+1)*(r.g2-r.g1+1)*(r.b2-r.b1+1)),r._volume},count:function(e){var r=this,t=r.histo;if(!r._count_set||e){var n,a,i,s=0;for(n=r.r1;n<=r.r2;n++)for(a=r.g1;a<=r.g2;a++)for(i=r.b1;i<=r.b2;i++)s+=t[o(n,a,i)]||0;r._count=s,r._count_set=!0}return r._count},copy:function(){var e=this;return new i(e.r1,e.r2,e.g1,e.g2,e.b1,e.b2,e.histo)},avg:function(e){var t=this,n=t.histo;if(!t._avg||e){var a,i,s,u,c=0,h=1<<8-r,l=0,f=0,p=0;for(i=t.r1;i<=t.r2;i++)for(s=t.g1;s<=t.g2;s++)for(u=t.b1;u<=t.b2;u++)c+=a=n[o(i,s,u)]||0,l+=a*(i+.5)*h,f+=a*(s+.5)*h,p+=a*(u+.5)*h;t._avg=c?[~~(l/c),~~(f/c),~~(p/c)]:[~~(h*(t.r1+t.r2+1)/2),~~(h*(t.g1+t.g2+1)/2),~~(h*(t.b1+t.b2+1)/2)]}return t._avg},contains:function(e){var r=this,n=e[0]>>t;return gval=e[1]>>t,bval=e[2]>>t,n>=r.r1&&n<=r.r2&&gval>=r.g1&&gval<=r.g2&&bval>=r.b1&&bval<=r.b2}},s.prototype={push:function(e){this.vboxes.push({vbox:e,color:e.avg()})},palette:function(){return this.vboxes.map(function(e){return e.color})},size:function(){return this.vboxes.size()},map:function(e){for(var r=this.vboxes,t=0;t<r.size();t++)if(r.peek(t).vbox.contains(e))return r.peek(t).color;return this.nearest(e)},nearest:function(e){for(var r,t,n,o=this.vboxes,a=0;a<o.size();a++)((t=Math.sqrt(Math.pow(e[0]-o.peek(a).color[0],2)+Math.pow(e[1]-o.peek(a).color[1],2)+Math.pow(e[2]-o.peek(a).color[2],2)))<r||void 0===r)&&(r=t,n=o.peek(a).color);return n},forcebw:function(){var r=this.vboxes;r.sort(function(r,t){return e.naturalOrder(e.sum(r.color),e.sum(t.color))});var t=r[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(r[0].color=[0,0,0]);var n=r.length-1,o=r[n].color;o[0]>251&&o[1]>251&&o[2]>251&&(r[n].color=[255,255,255])}},{quantize:function(c,h){if(!c.length||h<2||h>256)return!1;var l=function(e){var n,a=new Array(1<<3*r);return e.forEach(function(e){n=o(e[0]>>t,e[1]>>t,e[2]>>t),a[n]=(a[n]||0)+1}),a}(c);l.forEach(function(){});var f=function(e,r){var n,o,a,s=1e6,u=0,c=1e6,h=0,l=1e6,f=0;return e.forEach(function(e){(n=e[0]>>t)<s?s=n:n>u&&(u=n),(o=e[1]>>t)<c?c=o:o>h&&(h=o),(a=e[2]>>t)<l?l=a:a>f&&(f=a)}),new i(s,u,c,h,l,f,r)}(c,l),p=new a(function(r,t){return e.naturalOrder(r.count(),t.count())});function d(e,r){for(var t,o=e.size(),a=0;a<n;){if(o>=r)return;if(a++>n)return;if((t=e.pop()).count()){var i=u(l,t),s=i[0],c=i[1];if(!s)return;e.push(s),c&&(e.push(c),o++)}else e.push(t),a++}}p.push(f),d(p,.75*h);for(var g=new a(function(r,t){return e.naturalOrder(r.count()*r.volume(),t.count()*t.volume())});p.size();)g.push(p.pop());d(g,h);for(var v=new s;g.size();)v.push(g.pop());return v}}}().quantize;const t=function(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=e.naturalWidth,this.height=this.canvas.height=e.naturalHeight,this.context.drawImage(e,0,0,this.width,this.height)};t.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var n=function(){};n.prototype.getColor=function(e,r=10,t=!1){return this.getPalette(e,5,r,t)[0]},n.prototype.getPalette=function(e,n,o,a=!1,i=!1,s={pixelConsideredTransparentThreshold:10,imageConsideredTransparentThreshold:.1}){const u=function(e){let{colorCount:r,quality:t,includeWhite:n,checkTransparency:o,checkTransparencyConfig:a}=e;if(void 0!==r&&Number.isInteger(r)){if(1===r)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");r=Math.max(r,2),r=Math.min(r,20)}else r=10;if((void 0===t||!Number.isInteger(t)||t<1)&&(t=10),void 0!==n&&"boolean"==typeof n||(n=!1),void 0===o||"boolean"!=typeof o)o=!1;else if(void 0===a||"object"!=typeof a)a={pixelConsideredTransparentThreshold:10,imageConsideredTransparentThreshold:.1};else{const{pixelConsideredTransparentThreshold:e,imageConsideredTransparentThreshold:r}=a;if((void 0===e||Number.isNaN(e))&&(a.pixelConsideredTransparentThreshold=10),e<0||e>255)throw new Error("pixelConsideredTransparentThreshold should be between 0 and 255. Default is 10, meaning if a pixel's alpha (0-255) is less than this 10, the pixel is counted towards the overall transparency check.");if((void 0===r||Number.isNaN(r))&&(a.imageConsideredTransparentThreshold=.1),r<0||r>1)throw new Error("pixelConsideredTransparentThreshold should be between 0 and 1. Default is 0.1, meaning if 10% of the pixels trigger the pixelConsideredTransparentThreshold check, the image is considered transparent.")}return{colorCount:r,quality:t,includeWhite:n,checkTransparency:o,checkTransparencyConfig:a}}({colorCount:n,quality:o,includeWhite:a,checkTransparency:i,checkTransparencyConfig:s}),c=new t(e),h=c.getImageData(),l=c.width*c.height,{pixelArray:f,hasTransparency:p}=function(e,r,t){const{quality:n,includeWhite:o,checkTransparency:a,checkTransparencyConfig:i}=t,s=e,u=[];let c=0;for(let e,t,h,l,f,p=0;p<r;p+=n)e=4*p,t=s[e+0],h=s[e+1],l=s[e+2],f=s[e+3],void 0===f||f>=125?t>250&&h>250&&l>250&&!o||u.push([t,h,l]):a&&f<i.pixelConsideredTransparentThreshold&&c++;return{pixelArray:u,hasTransparency:a&&c/r.length>i.imageConsideredTransparentThreshold}}(h.data,l,u),d=r(f,u.colorCount),g=d?d.palette():null;return i?{palette:g,hasTransparency:p}:g},n.prototype.getColorFromUrl=function(e,r,t){const n=document.createElement("img");n.addEventListener("load",()=>{const o=this.getPalette(n,5,t);r(o[0],e)}),n.src=e},n.prototype.getImageData=function(e,r){let t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){if(200==this.status){let e=new Uint8Array(this.response);i=e.length;let t=new Array(i);for(let r=0;r<e.length;r++)t[r]=String.fromCharCode(e[r]);let n=t.join(""),o=window.btoa(n);r("data:image/png;base64,"+o)}},t.send()},n.prototype.getColorAsync=function(e,r,t){const n=this;this.getImageData(e,function(e){const o=document.createElement("img");o.addEventListener("load",function(){const e=n.getPalette(o,5,t);r(e[0],this)}),o.src=e})};export{n as default};
