if(!e)var e={map:function(e,t){var r={};return t?e.map(function(e,n){return r.index=n,t.call(r,e)}):e.slice()},naturalOrder:function(e,t){return e<t?-1:e>t?1:0},sum:function(e,t){var r={};return e.reduce(t?function(e,n,o){return r.index=o,e+t.call(r,n)}:function(e,t){return e+t},0)},max:function(t,r){return Math.max.apply(null,r?e.map(t,r):t)}};var t=function(){var t=5,r=8-t,n=1e3;function o(e,r,n){return(e<<2*t)+(r<<t)+n}function a(e){var t=[],r=!1;function n(){t.sort(e),r=!0}return{push:function(e){t.push(e),r=!1},peek:function(e){return r||n(),void 0===e&&(e=t.length-1),t[e]},pop:function(){return r||n(),t.pop()},size:function(){return t.length},map:function(e){return t.map(e)},debug:function(){return r||n(),t}}}function i(e,t,r,n,o,a,i){var s=this;s.r1=e,s.r2=t,s.g1=r,s.g2=n,s.b1=o,s.b2=a,s.histo=i}function s(){this.vboxes=new a(function(t,r){return e.naturalOrder(t.vbox.count()*t.vbox.volume(),r.vbox.count()*r.vbox.volume())})}function u(t,r){if(r.count()){var n=r.r2-r.r1+1,a=r.g2-r.g1+1,i=e.max([n,a,r.b2-r.b1+1]);if(1==r.count())return[r.copy()];var s,u,c,h,l=0,f=[],p=[];if(i==n)for(s=r.r1;s<=r.r2;s++){for(h=0,u=r.g1;u<=r.g2;u++)for(c=r.b1;c<=r.b2;c++)h+=t[o(s,u,c)]||0;f[s]=l+=h}else if(i==a)for(s=r.g1;s<=r.g2;s++){for(h=0,u=r.r1;u<=r.r2;u++)for(c=r.b1;c<=r.b2;c++)h+=t[o(u,s,c)]||0;f[s]=l+=h}else for(s=r.b1;s<=r.b2;s++){for(h=0,u=r.r1;u<=r.r2;u++)for(c=r.g1;c<=r.g2;c++)h+=t[o(u,c,s)]||0;f[s]=l+=h}return f.forEach(function(e,t){p[t]=l-e}),function(e){var t,n,o,a,i,u=e+"1",c=e+"2",h=0;for(s=r[u];s<=r[c];s++)if(f[s]>l/2){for(o=r.copy(),a=r.copy(),i=(t=s-r[u])<=(n=r[c]-s)?Math.min(r[c]-1,~~(s+n/2)):Math.max(r[u],~~(s-1-t/2));!f[i];)i++;for(h=p[i];!h&&f[i-1];)h=p[--i];return o[c]=i,a[u]=o[c]+1,[o,a]}}(i==n?"r":i==a?"g":"b")}}return i.prototype={volume:function(e){var t=this;return t._volume&&!e||(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},count:function(e){var t=this,r=t.histo;if(!t._count_set||e){var n,a,i,s=0;for(n=t.r1;n<=t.r2;n++)for(a=t.g1;a<=t.g2;a++)for(i=t.b1;i<=t.b2;i++)s+=r[o(n,a,i)]||0;t._count=s,t._count_set=!0}return t._count},copy:function(){var e=this;return new i(e.r1,e.r2,e.g1,e.g2,e.b1,e.b2,e.histo)},avg:function(e){var r=this,n=r.histo;if(!r._avg||e){var a,i,s,u,c=0,h=1<<8-t,l=0,f=0,p=0;for(i=r.r1;i<=r.r2;i++)for(s=r.g1;s<=r.g2;s++)for(u=r.b1;u<=r.b2;u++)c+=a=n[o(i,s,u)]||0,l+=a*(i+.5)*h,f+=a*(s+.5)*h,p+=a*(u+.5)*h;r._avg=c?[~~(l/c),~~(f/c),~~(p/c)]:[~~(h*(r.r1+r.r2+1)/2),~~(h*(r.g1+r.g2+1)/2),~~(h*(r.b1+r.b2+1)/2)]}return r._avg},contains:function(e){var t=this,n=e[0]>>r;return gval=e[1]>>r,bval=e[2]>>r,n>=t.r1&&n<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2}},s.prototype={push:function(e){this.vboxes.push({vbox:e,color:e.avg()})},palette:function(){return this.vboxes.map(function(e){return e.color})},size:function(){return this.vboxes.size()},map:function(e){for(var t=this.vboxes,r=0;r<t.size();r++)if(t.peek(r).vbox.contains(e))return t.peek(r).color;return this.nearest(e)},nearest:function(e){for(var t,r,n,o=this.vboxes,a=0;a<o.size();a++)((r=Math.sqrt(Math.pow(e[0]-o.peek(a).color[0],2)+Math.pow(e[1]-o.peek(a).color[1],2)+Math.pow(e[2]-o.peek(a).color[2],2)))<t||void 0===t)&&(t=r,n=o.peek(a).color);return n},forcebw:function(){var t=this.vboxes;t.sort(function(t,r){return e.naturalOrder(e.sum(t.color),e.sum(r.color))});var r=t[0].color;r[0]<5&&r[1]<5&&r[2]<5&&(t[0].color=[0,0,0]);var n=t.length-1,o=t[n].color;o[0]>251&&o[1]>251&&o[2]>251&&(t[n].color=[255,255,255])}},{quantize:function(c,h){if(!c.length||h<2||h>256)return!1;var l=function(e){var n,a=new Array(1<<3*t);return e.forEach(function(e){n=o(e[0]>>r,e[1]>>r,e[2]>>r),a[n]=(a[n]||0)+1}),a}(c);l.forEach(function(){});var f=function(e,t){var n,o,a,s=1e6,u=0,c=1e6,h=0,l=1e6,f=0;return e.forEach(function(e){(n=e[0]>>r)<s?s=n:n>u&&(u=n),(o=e[1]>>r)<c?c=o:o>h&&(h=o),(a=e[2]>>r)<l?l=a:a>f&&(f=a)}),new i(s,u,c,h,l,f,t)}(c,l),p=new a(function(t,r){return e.naturalOrder(t.count(),r.count())});function d(e,t){for(var r,o=e.size(),a=0;a<n;){if(o>=t)return;if(a++>n)return;if((r=e.pop()).count()){var i=u(l,r),s=i[0],c=i[1];if(!s)return;e.push(s),c&&(e.push(c),o++)}else e.push(r),a++}}p.push(f),d(p,.75*h);for(var g=new a(function(t,r){return e.naturalOrder(t.count()*t.volume(),r.count()*r.volume())});p.size();)g.push(p.pop());d(g,h);for(var v=new s;g.size();)v.push(g.pop());return v}}}().quantize;const r=function(e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=e.naturalWidth,this.height=this.canvas.height=e.naturalHeight,this.context.drawImage(e,0,0,this.width,this.height)};r.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var n=function(){};n.prototype.getColor=function(e,t=10,r=!1){return this.getPalette(e,5,t,r)[0]},n.prototype.getPalette=function(e,n,o,a=!1,i=!1,s={pixelConsideredTransparentThreshold:125,imageConsideredTransparentThreshold:0}){const u=function(e){let{colorCount:t,quality:r,includeWhite:n,checkTransparency:o,checkTransparencyConfig:a}=e;if(void 0!==t&&Number.isInteger(t)){if(1===t)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");t=Math.max(t,2),t=Math.min(t,20)}else t=10;if((void 0===r||!Number.isInteger(r)||r<1)&&(r=10),void 0!==n&&"boolean"==typeof n||(n=!1),void 0===o||"boolean"!=typeof o)o=!1;else if(void 0===a||"object"!=typeof a)a={pixelConsideredTransparentThreshold:125,imageConsideredTransparentThreshold:0};else{const{pixelConsideredTransparentThreshold:e,imageConsideredTransparentThreshold:t}=a;if((void 0===e||Number.isNaN(e))&&(a.pixelConsideredTransparentThreshold=125),e<0||e>255)throw new Error("pixelConsideredTransparentThreshold should be between 0 and 255. Default is 125, meaning if a pixel's alpha (0-255) is less than this 125, the pixel is counted towards the overall transparency check.");if((void 0===t||Number.isNaN(t))&&(a.imageConsideredTransparentThreshold=0),t<0||t>1)throw new Error("pixelConsideredTransparentThreshold should be between 0 and 1. Default is 0. If set to 0, any transparent pixel detected will mean the image is considered to be transparent. Any number greater than 0 serves as a treshold. For example, when set to 0.1 (a target of 10%); if 10% of all the pixels trigger the pixelConsideredTransparentThreshold check, the image is considered transparent.")}return{colorCount:t,quality:r,includeWhite:n,checkTransparency:o,checkTransparencyConfig:a}}({colorCount:n,quality:o,includeWhite:a,checkTransparency:i,checkTransparencyConfig:s}),c=new r(e),h=c.getImageData(),l=c.width*c.height,{pixelArray:f,hasTransparency:p}=function(e,t,r){const{quality:n,includeWhite:o,checkTransparency:a,checkTransparencyConfig:i}=r,s=e,u=[];let c=0;for(let e,r,h,l,f,p=0;p<t;p+=n)e=4*p,r=s[e+0],h=s[e+1],l=s[e+2],f=s[e+3],void 0===f||f>=i.pixelConsideredTransparentThreshold?r>250&&h>250&&l>250&&!o||u.push([r,h,l]):a&&f<i.pixelConsideredTransparentThreshold&&c++;return{pixelArray:u,hasTransparency:a&&c/(t/n)>i.imageConsideredTransparentThreshold}}(h.data,l,u),d=t(f,u.colorCount),g=d?d.palette():null;return i?{palette:g,hasTransparency:p}:g},n.prototype.getColorFromUrl=function(e,t,r){const n=document.createElement("img");n.addEventListener("load",()=>{const o=this.getPalette(n,5,r);t(o[0],e)}),n.src=e},n.prototype.getImageData=function(e,t){let r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){if(200==this.status){let e=new Uint8Array(this.response);i=e.length;let r=new Array(i);for(let t=0;t<e.length;t++)r[t]=String.fromCharCode(e[t]);let n=r.join(""),o=window.btoa(n);t("data:image/png;base64,"+o)}},r.send()},n.prototype.getColorAsync=function(e,t,r){const n=this;this.getImageData(e,function(e){const o=document.createElement("img");o.addEventListener("load",function(){const e=n.getPalette(o,5,r);t(e[0],this)}),o.src=e})};export{n as default};
